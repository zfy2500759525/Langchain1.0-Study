# Module 09 - Checkpointing 修正说明

## 问题发现

**错误用法**（会导致 `unable to open database file` 错误）：
```python
SqliteSaver.from_conn_string("sqlite:///checkpoints.sqlite")
```

**正确用法**：
```python
SqliteSaver.from_conn_string("checkpoints.sqlite")  # 直接传文件名
```

## 正确的语法（2025 最新）

### 1. 相对路径
```python
with SqliteSaver.from_conn_string("checkpoints.sqlite") as checkpointer:
    agent = create_agent(model=model, checkpointer=checkpointer)
```

### 2. 绝对路径（Windows）
```python
with SqliteSaver.from_conn_string("C:/data/checkpoints.sqlite") as checkpointer:
    agent = create_agent(model=model, checkpointer=checkpointer)
```

### 3. 内存数据库
```python
with SqliteSaver.from_conn_string(":memory:") as checkpointer:
    agent = create_agent(model=model, checkpointer=checkpointer)
```

## 关键点

1. ✅ **必须使用 `with` 语句**：`SqliteSaver.from_conn_string()` 返回上下文管理器
2. ✅ **不要加 `sqlite:///` 前缀**：直接传文件路径
3. ✅ **相对路径更简单**：在当前目录创建数据库文件
4. ✅ **程序退出会自动关闭连接**：`with` 语句确保资源释放

## 已修正的文件

- ✅ `test.py` - 验证通过，成功持久化
- ✅ `main.py` - 所有示例已更新
- ⏳ `README.md` - 需要更新文档

## 安装依赖

```bash
pip install langgraph-checkpoint-sqlite>=3.0.0
```

已添加到 `requirements.txt`
